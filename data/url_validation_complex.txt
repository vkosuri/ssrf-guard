# ==============================================================================
# Complex SSRF Attack Patterns
# ==============================================================================
#
# Source: Real-world SSRF attack patterns and research
#
# Purpose: Tests sophisticated multi-vector SSRF attacks that combine
#          multiple bypass techniques. These simulate real attacker behavior
#          where the SSRF payload is embedded in query parameters, fragments,
#          or other URL components of an otherwise-legitimate URL.
#
# Attack categories:
#   1. Metadata IP as subdomain of attacker (169.254.169.254.attacker.com)
#   2. Metadata IP with special suffix chars (169.254.169.254_.attacker.com)
#   3. Metadata IP in userinfo/credentials (@)
#   4. SSRF payload in query parameters (?url=http://169.254.169.254/...)
#   5. SSRF payload in fragments (#)
#   6. Shorthand IP addresses (172.16, 169.254)
#   7. Double @ credential confusion with metadata IPs
#   8. Various URL encoding in query parameter values
#   9. Embedded dangerous schemes in query (gopher://, file://)
#  10. Path traversal via query parameters
#  11. CRLF injection in query values
#  12. Port manipulation in query values
#  13. Double-encoded metadata URLs in query
#  14. Unicode/special chars in query paths
#  15. JSON/structured payloads containing SSRF URLs
#
# Expected result: ALL entries should be BLOCKED.
# ==============================================================================

# --- Metadata IP as subdomain of attacker ---
http://169.254.169.254.attacker.com/latest/meta-data/

# --- Metadata IP with special suffix characters ---
http://169.254.169.254_.attacker.com/latest/meta-data/

# --- Metadata IP in userinfo (credentials section) ---
http://169.254.169.254@attacker.com/latest/meta-data/
http://169.254.169.254:443@attacker.com/latest/meta-data/

# --- SSRF payload in query parameters ---
http://attacker.com?redirect=http://169.254.169.254/latest/meta-data/
http://attacker.com?url=http://metadata.google.internal/computeMetadata/v1/
http://attacker.com?target=http://169.254.169.254/latest/user-data/

# --- SSRF payload in fragment ---
http://attacker.com#http://169.254.169.254/latest/meta-data/
http://attacker.com#metadata.google.internal/computeMetadata/v1/

# --- Shorthand IPs (fewer than 4 octets) ---
http://172.16/computeMetadata/v1/

# --- IPv4 encoding tricks targeting metadata ---
# (various hex, octal, decimal representations tested in cloud_metadata.txt)

# --- DNS resolution edge cases ---
# (hostnames that might resolve to private IPs)

# --- Double @ credential confusion with metadata IPs ---
http://169.254.169.254@169.254.169.254@attacker.com/latest/meta-data/
http://attacker@169.254.169.254@attacker.com/latest/meta-data/

# --- Shorthand metadata IP ---
http://169.254/latest/meta-data/

# --- Cloud metadata in query with various encodings ---
http://attacker.com?redirect=http://169.254.169.254/latest/meta-data/
http://attacker.com?url=http%3A%2F%2F169.254.169.254%2Flatest%2Fmeta-data%2F
http://attacker.com?target=http://0xa9fea9fe/latest/meta-data/
http://attacker.com?endpoint=http://2852039166/latest/meta-data/
http://attacker.com?proxy=http://169.254.169.254:443/latest/meta-data/

# --- Percent-encoded dots in query metadata URL ---
http://attacker.com?goto=http://169%2E254%2E169%2E254/latest/meta-data/
http://attacker.com?next=http://169.254.169.254%2Flatest%2Fmeta-data%2F
http://attacker.com?redirect=http://169.254.169.254/latest%2Fmeta-data%2F

# --- Multiple query parameters with SSRF payload ---
http://attacker.com?url=http://169.254.169.254/latest/meta-data/&foo=bar
http://attacker.com?legitimate=yes&redirect=http://169.254.169.254/latest/meta-data/
http://attacker.com?a=1&b=2&target=http://metadata.google.internal/computeMetadata/v1/

# --- Query parameter with special characters ---
http://attacker.com?url=http://169.254.169.254/latest/meta-data/;attacker.com
http://attacker.com?url=http://169.254.169.254/latest/meta-data/?foo=bar
http://attacker.com?url=http://169.254.169.254/latest/meta-data/%23admin

# --- Case variation in query parameter names ---
http://attacker.com?URL=http://169.254.169.254/latest/meta-data/
http://attacker.com?Url=http://169.254.169.254/latest/meta-data/
http://attacker.com?rEdirect=http://169.254.169.254/latest/meta-data/

# --- Null byte injection in query ---
http://attacker.com?url=http://169.254.169.254/latest/meta-data/%00&safe=true
http://attacker.com?url=http://169.254.169.254%00.safe.com/latest/meta-data/

# --- Chained redirects in query ---
http://attacker.com?redirect=http://trusted.com?redirect=http://169.254.169.254/latest/meta-data/
http://attacker.com?url=http://redirect.service.com?target=http://169.254.169.254/latest/user-data/

# --- IPv6 metadata in query ---
http://attacker.com?endpoint=http://[fd00:ec2::254]/latest/meta-data/
http://attacker.com?url=http://[fd00:ec2::254]:443/latest/meta-data/
http://attacker.com?gateway=http://user@[fd00:ec2::254]/latest/meta-data/

# --- Shorthand private IPs in query ---
http://attacker.com?redirect=http://10.0/latest/meta-data/
http://attacker.com?url=http://127.1/latest/meta-data/
http://attacker.com?target=http://192.168/latest/meta-data/

# --- Path traversal in query ---
http://attacker.com?file=http://169.254.169.254/latest/../../etc/passwd
http://attacker.com?path=http://169.254.169.254/latest/meta-data/../../../../windows/win.ini

# --- Alternative parameter names ---
http://attacker.com?redir=http://169.254.169.254/latest/meta-data/
http://attacker.com?jump=http://169.254.169.254/latest/meta-data/
http://attacker.com?go=http://169.254.169.254/latest/meta-data/
http://attacker.com?callback=http://169.254.169.254/latest/meta-data/
http://attacker.com?return=http://169.254.169.254/latest/meta-data/

# --- Fragment injection with metadata ---
http://attacker.com?url=http://169.254.169.254/latest/meta-data/%23comment
http://attacker.com?redirect=http://169.254.169.254/latest/meta-data/#payload

# --- CRLF injection in query ---
http://attacker.com?url=http://169.254.169.254/latest/meta-data/%0d%0a&safe=true
http://attacker.com?redirect=http://169.254.169.254/latest/meta-data/%0a%0dHost:attacker.com

# --- Port manipulation in query ---
http://attacker.com?url=http://169.254.169.254:80/latest/meta-data/
http://attacker.com?endpoint=http://169.254.169.254:8080/latest/meta-data/
http://attacker.com?target=http://169.254.169.254:anything/latest/meta-data/

# --- Double-encoded metadata in query ---
http://attacker.com?url=http://169.254.169.254/latest/%252Fmeta-data%252F
http://attacker.com?redirect=http://169.254.169.254%252Flatest%252Fmeta-data%252F

# --- Whitespace injection in query ---
http://attacker.com?url=http://169.254.169.254/latest%20/meta-data/
http://attacker.com?target=http://169.254.169.254/latest%09meta-data/
http://attacker.com?endpoint=http://169.254.169.254/latest%0bmeta-data/

# --- Dangerous schemes in query ---
http://attacker.com?url=gopher://169.254.169.254:9000/latest/meta-data/
http://attacker.com?redirect=dict://169.254.169.254:11211/
http://attacker.com?target=file://169.254.169.254/latest/meta-data/

# --- Credentials in query URL ---
http://attacker.com?url=http://user:pass@169.254.169.254/latest/meta-data/
http://attacker.com?endpoint=http://admin:secret@169.254.169.254/latest/meta-data/

# --- Unicode/special chars in query paths ---
http://attacker.com?url=http://169.254.169.254/latest/meta-data/‚Ñå‚Ñå‚Ñå
http://attacker.com?redirect=http://169.254.169.254/latest/meta-data/üîê

# --- Path normalization in query ---
http://attacker.com?url=http://169.254.169.254//latest/meta-data/
http://attacker.com?target=http://169.254.169.254/./latest/meta-data/
http://attacker.com?endpoint=http://169.254.169.254/latest//meta-data/

# --- Semicolon path parameters in query ---
http://attacker.com?url=http://169.254.169.254/latest/meta-data/;safe
http://attacker.com?redirect=http://169.254.169.254/latest/meta-data/;user=admin

# --- Bracket confusion in query ---
http://attacker.com?url=http://[169.254.169.254]/latest/meta-data/
http://attacker.com?target=http://[169.254.169.254]:443/latest/meta-data/

# --- Hex values in query (not IP encoding, but in parameters) ---
http://attacker.com?url=http://169.254.169.254/latest/meta-data/?key=0x123456
http://attacker.com?redirect=http://169.254.169.254/latest/meta-data/?token=0xdeadbeef

# --- JSON/structured payloads in query ---
http://attacker.com?data={"url":"http://169.254.169.254/latest/meta-data/"}
http://attacker.com?config=url:http://169.254.169.254/latest/meta-data/
http://attacker.com?payload=image_url=http://169.254.169.254/latest/meta-data/