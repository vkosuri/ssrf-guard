# ==============================================================================
# Bug #12: IPv4-Compatible IPv6 Addresses Not Checked
# ==============================================================================
#
# Severity: ðŸŸ¡ P1 (SSRF Bypass)
#
# Description:
#   The original code checked IPv4-MAPPED IPv6 (::ffff:x.x.x.x) but
#   NOT IPv4-COMPATIBLE IPv6 (::x.x.x.x â€” deprecated in RFC 4291).
#
#   IPv4-mapped:     ::ffff:127.0.0.1 â†’ was checked â†’ BLOCKED âœ“
#   IPv4-compatible: ::127.0.0.1      â†’ was NOT checked â†’ ALLOWED âœ—
#
#   Although deprecated, ::x.x.x.x is still parsed by inet_pton()
#   and some network stacks, making it a valid bypass vector.
#
# Fix applied:
#   Added detection of IPv4-compatible addresses (first 12 bytes = 0)
#   in isPrivateOrReservedIPv6(). Extracts the embedded IPv4 address
#   and checks it against isPrivateOrReservedIPv4().
#
# Expected result: ALL entries should be BLOCKED.
# ==============================================================================

# --- IPv4-compatible IPv6 â€” loopback (::127.0.0.1) ---
http://[::127.0.0.1]/
https://[::127.0.0.1]/
http://[::127.0.0.1]:8080/
https://[::127.0.0.1]:443/

# --- IPv4-compatible IPv6 â€” private ranges ---
http://[::10.0.0.1]/
http://[::192.168.1.1]/
http://[::172.16.0.1]/

# --- IPv4-compatible IPv6 â€” link-local/metadata ---
http://[::169.254.169.254]/
https://[::169.254.169.254]/latest/meta-data/
http://[::169.254.170.2]/

# --- IPv4-compatible IPv6 â€” CGNAT (Alibaba metadata) ---
http://[::100.100.100.200]/

# --- IPv4-compatible IPv6 â€” broadcast/zero ---
http://[::0.0.0.0]/
http://[::255.255.255.255]/

# --- Long form IPv4-compatible ---
http://[0:0:0:0:0:0:127.0.0.1]/
http://[0:0:0:0:0:0:169.254.169.254]/
http://[0000:0000:0000:0000:0000:0000:127.0.0.1]/

# --- Verify: IPv4-mapped (::ffff:) still works after fix ---
http://[::ffff:127.0.0.1]/
http://[::ffff:169.254.169.254]/
http://[::ffff:10.0.0.1]/
http://[::ffff:192.168.1.1]/
http://[::ffff:172.16.0.1]/
http://[0:0:0:0:0:ffff:127.0.0.1]/