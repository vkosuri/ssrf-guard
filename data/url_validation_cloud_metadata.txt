# ==============================================================================
# Cloud Metadata Endpoint Tests
# ==============================================================================
#
# Source: AWS, GCP, Azure, DigitalOcean, Oracle Cloud SSRF documentation
#
# Purpose: Tests that all known cloud metadata service endpoints are blocked.
#          Cloud metadata services are the #1 target for SSRF attacks because
#          they expose IAM credentials, instance identity, and configuration.
#
# Services covered:
#   - AWS EC2 Instance Metadata Service (IMDS) v1
#     IP: 169.254.169.254, paths: /latest/meta-data/, /latest/user-data/
#   - AWS ECS Task Metadata
#     IP: 169.254.170.2, paths: /v2/, /v3/
#   - GCP Compute Engine Metadata
#     Host: metadata.google.internal, path: /computeMetadata/v1/
#   - Azure Instance Metadata Service (IMDS)
#     IP: 169.254.169.254, path: /metadata/instance
#   - DigitalOcean Metadata
#     IP: 169.254.169.254, path: /metadata/v1/
#   - Oracle Cloud Infrastructure (OCI)
#     IP: 169.254.169.254, path: /opc/v1/
#   - AWS IPv6 Metadata
#     IP: fd00:ec2::254
#
# Also tests:
#   - Hex/decimal encoded IPs (0xa9fea9fe, 2852039166)
#   - Path traversal attempts
#   - Alternative protocol access (gopher, dict, ftp, file)
#
# Expected result: ALL entries should be BLOCKED.
# ==============================================================================

# --- AWS EC2 Metadata Service (IMDS v1) ---
http://169.254.169.254/latest/meta-data/
http://169.254.169.254/latest/meta-data/instance-type
http://169.254.169.254/latest/meta-data/ami-id
http://169.254.169.254/latest/meta-data/hostname
http://169.254.169.254/latest/meta-data/instance-id
http://169.254.169.254/latest/meta-data/mac
http://169.254.169.254/latest/meta-data/network/interfaces/macs/
http://169.254.169.254/latest/meta-data/iam/
http://169.254.169.254/latest/meta-data/iam/security-credentials/
http://169.254.169.254/latest/meta-data/iam/security-credentials/EC2RoleWithAccess
http://169.254.169.254/latest/user-data/
http://169.254.169.254/latest/dynamic/instance-identity/document

# --- AWS ECS Task Metadata ---
http://169.254.170.2/v2/credentials
http://169.254.170.2/v2/metadata
http://169.254.170.2/v3/credentials
http://169.254.170.2/v3/metadata

# --- GCP Compute Engine Metadata ---
http://metadata.google.internal/computeMetadata/v1/
http://metadata.google.internal/computeMetadata/v1/instance/
http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/
http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/
http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token
http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/identity
http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/email
http://metadata.google.internal/computeMetadata/v1/instance/machine-type
http://metadata.google.internal/computeMetadata/v1/instance/hostname
http://metadata.google.internal/computeMetadata/v1/instance/id
http://metadata.google.internal/computeMetadata/v1/instance/zone
http://metadata.google.internal/computeMetadata/v1/project/
http://metadata.google.internal/computeMetadata/v1/project/project-id
http://metadata.google.internal/computeMetadata/v1/project/attributes/ssh-keys

# --- Azure Instance Metadata Service (IMDS) ---
http://169.254.169.254/metadata/instance?api-version=2021-02-01
http://169.254.169.254/metadata/identity/oauth2/token?api-version=2021-02-01&resource=https://management.azure.com/
http://169.254.169.254/metadata/identity/oauth2/token?api-version=2021-02-01&resource=https://graph.microsoft.com/
http://169.254.169.254/metadata/v1/instanceinfo

# --- DigitalOcean Metadata ---
http://169.254.169.254/metadata/v1/
http://169.254.169.254/metadata/v1/id
http://169.254.169.254/metadata/v1/user-data
http://169.254.169.254/metadata/v1/hostname
http://169.254.169.254/metadata/v1/interfaces/private
http://169.254.169.254/metadata/v1/interfaces/public
http://169.254.169.254/metadata/v1/region

# --- Oracle Cloud Infrastructure (OCI) Metadata ---
http://169.254.169.254/opc/v1/
http://169.254.169.254/opc/v1/instance/
http://169.254.169.254/opc/v1/instance/id
http://169.254.169.254/opc/v1/instance/displayName
http://169.254.169.254/opc/v1/instance/compartmentId
http://169.254.169.254/opc/v1/instance/availabilityDomain

# --- AWS IPv6 Metadata (fd00:ec2::254) ---
http://[fd00:ec2::254]/latest/meta-data/
http://[fd00:ec2::254]/latest/meta-data/instance-id
http://[fd00:ec2::254]/latest/meta-data/iam/security-credentials/

# --- GCP Metadata IPv6 ---
http://[fd00::]/computeMetadata/v1/instance/service-accounts/default/token

# --- Encoded IP variants (hex/decimal) ---
http://2852039166/latest/meta-data/
http://0xa9fea9fe/latest/meta-data/
http://0xfe/latest/meta-data/
http://169.254.169.254%252flatest%252fmeta-data%252f

# --- Path traversal attempts ---
http://169.254.169.254/latest/../../etc/passwd
http://169.254.169.254/latest/meta-data/../../user-data
http://169.254.169.254/latest/meta-data/../../../windows/win.ini

# --- Alternative protocol access (blocked by scheme check) ---
gopher://169.254.169.254:9000/latest/meta-data/
dict://169.254.169.254:11211/
ftp://169.254.169.254/latest/meta-data/
file://169.254.169.254/latest/meta-data/